import{R as Z,a as $,b as ee}from"./_referral-patient-form-B96PHQzf.js";import{r as b,o as n,c as C,a as i,w as a,g as l,f as g,t as k,F as M,i as W,b as f,e as F,d as Q,T as te,l as re,s as se,n as oe,p as ie,k as ae}from"./app-BXgbEd8A.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={props:{attorneys:{type:Object,required:!0,default:()=>{}},doctors:{type:Object,required:!0,default:()=>{}},documentCategories:{type:Object,required:!0,default:()=>{}},form:{type:Object,required:!0,default:()=>{}},medicalSpecialties:{type:Object,required:!0,default:()=>{}},patients:{type:Object,required:!0,default:()=>{}},referralReasons:{type:Object,required:!1,default:()=>{}},referralStatuses:{type:Object,required:!1,default:()=>{}},states:{type:Object,required:!1,default:()=>{}}}},ne={class:"divide-y divide-gray-200"},de={class:"flex items-center gap-2"},ce=l("div",{class:"flex items-center gap-2"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 text-pink-500"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"})]),l("span",{class:"text-pink-500"},"Document"),f(" Information ")],-1),ue={key:0,class:"text-red-500 font-medium italic"},_e={key:0,class:"mb-4 p-4 bg-gray-100 rounded"},fe=l("h3",{class:"font-bold"},"Debug Info:",-1),me={class:"relative grid grid-cols-1 gap-4"},pe={key:0,class:"w-full h-full absolute bg-white opacity-50"},he={key:0,class:"space-y-1"},ye={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},ge=l("span",{class:"text-red-500 uppercase"}," Cancel ",-1),be={key:1,class:"text-center py-8"},ve=l("p",{class:"text-gray-500"},"No document categories available for your role.",-1),Ce=[ve];function xe(t,s,r,h,e,o){const u=b("v-section-heading"),x=b("v-content-body"),_=b("v-link"),m=b("v-form-label"),v=b("v-form-file"),D=b("v-form-group"),A=b("v-card");return n(),C("div",ne,[i(x,null,{default:a(()=>[i(u,null,{title:a(()=>[l("div",de,[ce,r.form.state_id?g("",!0):(n(),C("div",ue," Please select a referral state. "))])]),_:1})]),_:1}),i(x,null,{default:a(()=>[(n(),C("div",_e,[fe,l("pre",null,k(JSON.stringify(r.documentCategories,null,2)),1)])),l("div",me,[r.form.state_id?g("",!0):(n(),C("div",pe)),(n(!0),C(M,null,W(r.documentCategories.data,(y,R)=>(n(),C(M,{key:"documentCategory_"+R},[y.document_types&&y.document_types.length?(n(),C("div",he,[i(u,null,{title:a(()=>[f(k(y.name),1)]),_:2},1024),l("div",ye,[(n(!0),C(M,null,W(y.document_types,(S,j)=>(n(),F(A,{key:"documentType_"+j},{default:a(()=>[i(x,null,{default:a(()=>[i(D,null,{default:a(()=>[i(m,{class:"flex items-center justify-between"},{default:a(()=>[f(k(S.name)+" ",1),r.form.documents[S.document_type_id]?(n(),F(_,{key:0,href:"#",onClick:Q(V=>r.form.documents[S.document_type_id]=null,["stop"])},{default:a(()=>[ge]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024),i(v,{modelValue:r.form.documents[S.document_type_id],"onUpdate:modelValue":V=>r.form.documents[S.document_type_id]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])])):g("",!0)],64))),128)),!r.documentCategories.data||r.documentCategories.data.length===0?(n(),C("div",be,Ce)):g("",!0)])]),_:1})])}const we=Y(le,[["render",xe]]),ke={props:{items:{type:Array,default:()=>[]}},data(){return{form:{policy_limit:"",pip:"",defendant_insurance:"",plaintiff_insurance:"",commercial_case:!1,type_of_accident:"",errors:{},processing:!1},typeOfAccidentOptions:[{label:"Motor Vehicle Accident",value:"motor_vehicle"},{label:"Workplace Accident",value:"workplace"},{label:"Medical Malpractice",value:"medical_malpractice"},{label:"Slip and Fall",value:"slip_and_fall"}]}},methods:{filterItems(){this.items.filter(t=>t.someCondition)},updateParent(){this.$emit("update:insuranceData",{...this.form})},submitForm(){this.form.processing=!0,setTimeout(()=>{this.form.processing=!1,alert("Form submitted!")},2e3)}}},De={class:"divide-y divide-gray-200"},Fe=l("div",{class:"flex items-center gap-2"},[l("div",{class:"flex items-center gap-2"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 text-primary-500"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"})]),l("span",{class:"text-dark-500"},"Insurance"),f(" Information ")])],-1),Se=l("span",{class:"text-dark-500 italic"},"Policy Limit",-1),Ve=l("span",{class:"text-dark-500 italic"},"PIP",-1),Ae=l("span",{class:"text-dark-500 italic"},"Defendant Insurance",-1),Re=l("span",{class:"text-dark-500 italic"},"Plaintiff Insurance",-1),je=l("span",{class:"text-dark-500 italic"},"Type of Accident",-1);function Ue(t,s,r,h,e,o){const u=b("v-section-heading"),x=b("v-content-body"),_=b("v-form-label"),m=b("v-form-input"),v=b("v-form-error"),D=b("v-form-group"),A=b("v-form-select");return n(),C("div",De,[i(x,null,{default:a(()=>[i(u,null,{title:a(()=>[Fe]),_:1})]),_:1}),i(x,{class:"relative grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-6 gap-4"},{default:a(()=>[i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[Se]),_:1}),i(m,{type:"number",modelValue:e.form.policy_limit,"onUpdate:modelValue":s[0]||(s[0]=y=>e.form.policy_limit=y),error:e.form.errors.policy_limit,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.policy_limit?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.policy_limit),1)]),_:1})):g("",!0)]),_:1}),i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[Ve]),_:1}),i(m,{type:"number",modelValue:e.form.pip,"onUpdate:modelValue":s[1]||(s[1]=y=>e.form.pip=y),error:e.form.errors.pip,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.pip?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.pip),1)]),_:1})):g("",!0)]),_:1}),i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[Ae]),_:1}),i(m,{type:"text",modelValue:e.form.defendant_insurance,"onUpdate:modelValue":s[2]||(s[2]=y=>e.form.defendant_insurance=y),error:e.form.errors.defendant_insurance,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.defendant_insurance?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.defendant_insurance),1)]),_:1})):g("",!0)]),_:1}),i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[Re]),_:1}),i(m,{type:"text",modelValue:e.form.plaintiff_insurance,"onUpdate:modelValue":s[3]||(s[3]=y=>e.form.plaintiff_insurance=y),error:e.form.errors.plaintiff_insurance,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.plaintiff_insurance?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.plaintiff_insurance),1)]),_:1})):g("",!0)]),_:1}),i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[f("Is it a Commercial Case?")]),_:1}),i(A,{options:[{label:"Yes",value:!0},{label:"No",value:!1}],error:e.form.errors.commercial_case,disabled:e.form.processing,required:!0,modelValue:e.form.commercial_case,"onUpdate:modelValue":s[4]||(s[4]=y=>e.form.commercial_case=y)},null,8,["error","disabled","modelValue"]),e.form.errors.commercial_case?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.commercial_case),1)]),_:1})):g("",!0)]),_:1}),i(D,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(_,null,{default:a(()=>[je]),_:1}),i(A,{options:e.typeOfAccidentOptions,modelValue:e.form.type_of_accident,"onUpdate:modelValue":s[5]||(s[5]=y=>e.form.type_of_accident=y),error:e.form.errors.type_of_accident,onChange:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["options","modelValue","error","onChange"]),e.form.errors.type_of_accident?(n(),F(v,{key:0},{default:a(()=>[f(k(e.form.errors.type_of_accident),1)]),_:1})):g("",!0)]),_:1})]),_:1})])}const qe=Y(ke,[["render",Ue]]),Pe={name:"ReferralsCreateForm",components:{"x-referral-attorney-form":Z,"x-referral-doctor-form":$,"x-referral-documents-form":we,"x-referral-patient-form":ee,"x-policy-form":qe},props:{attorneys:{type:Object,required:!0},doctors:{type:Object,required:!0},physicians:{type:Object,required:!0},documentCategories:{type:Object,required:!1},medicalSpecialties:{type:Object,required:!0},patients:{type:Object,required:!0},referralReasons:{type:Object,required:!1},referralStatuses:{type:Object,required:!1},referralStates:{type:Object,required:!1},states:{type:Object,required:!1},listRoute:{type:String,default:"panel.admin.referrals.index"},storeRoute:{type:String,default:"panel.admin.referrals.store"},icdCodes:{type:Object,required:!1},CptCodes:{type:Object,required:!1}},data(){var e,o,u,x,_,m,v,D,A,y,R,S,j,V,q,U,d,w,O,z,N,B,L,T,E,H,c,I,G,J,K;const t=this.$page.props.auth.user,s=(o=(e=t==null?void 0:t.roles)==null?void 0:e[0])==null?void 0:o.name;let r=null,h=null;if(s==="Attorney"){const p=(((u=this.attorneys)==null?void 0:u.data)||[]).find(X=>X.user_id===t.user_id);p&&(r={name:p.name,email:p.email,phone_number:p.phone_number||"",user_id:p.user_id,law_firm:{name:((x=p.law_firm)==null?void 0:x.name)||"",email:((_=p.law_firm)==null?void 0:_.email)||"",phone_number:((m=p.law_firm)==null?void 0:m.phone_number)||"",address_line_1:((v=p.law_firm)==null?void 0:v.address_line_1)||"",address_line_2:((D=p.law_firm)==null?void 0:D.address_line_2)||"",city:((A=p.law_firm)==null?void 0:A.city)||"",state_id:((y=p.law_firm)==null?void 0:y.state_id)||t.state_id||"",zip_code:((R=p.law_firm)==null?void 0:R.zip_code)||""}})}else if(s==="Doctor"){const p=(((S=this.doctors)==null?void 0:S.data)||[]).find(X=>X.user_id===t.user_id);p&&(h={user_id:p.user_id,name:p.name,email:p.email,phone_number:p.phone_number||"",medical_specialty_id:p.medical_specialty_id||null,clinic:{clinic_id:((V=(j=p.clinics)==null?void 0:j[0])==null?void 0:V.clinic_id)||"",name:((U=(q=p.clinics)==null?void 0:q[0])==null?void 0:U.name)||"",email:((w=(d=p.clinics)==null?void 0:d[0])==null?void 0:w.email)||"",phone_number:((z=(O=p.clinics)==null?void 0:O[0])==null?void 0:z.phone_number)||"",address_line_1:((B=(N=p.clinics)==null?void 0:N[0])==null?void 0:B.address_line_1)||"",address_line_2:((T=(L=p.clinics)==null?void 0:L[0])==null?void 0:T.address_line_2)||"",city:((H=(E=p.clinics)==null?void 0:E[0])==null?void 0:H.city)||"",state_id:((I=(c=p.clinics)==null?void 0:c[0])==null?void 0:I.state_id)||t.state_id||"",zip_code:((J=(G=p.clinics)==null?void 0:G[0])==null?void 0:J.zip_code)||""},notes:""})}return{form:te({referral_date:new Date().toISOString().split("T")[0],referral_status_id:1,state_id:(t==null?void 0:t.state_id)||"",attorney_user_id:(r==null?void 0:r.user_id)||"",doctor_user_id:(h==null?void 0:h.user_id)||"",patient_user_id:"",clinic_id:((K=h==null?void 0:h.clinic)==null?void 0:K.clinic_id)||"",attorney:r||{name:"",email:"",phone_number:"",user_id:"",law_firm:{name:"",email:"",phone_number:"",address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""}},doctor:h||{user_id:"",name:"",email:"",phone_number:"",medical_specialty_id:null,clinic:{clinic_id:"",name:"",email:"",phone_number:"",address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""},notes:""},patient:{name:"",email:"",phone_number:"",user_id:"",height:"",weight:"",gender:"",birthdate:"",injury_date:new Date().toISOString().split("T")[0],referral_reason_ids:[],address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""},documents:{},selectedCptCodes:[],insuranceData:{},billing_type:"",is_cms1500_generated:!1,case_won:!1,outcome:"",reduction_accepted:!1,is_closed:!1,closed_at:null,created_at:null,updated_at:null}),localAttorneys:this.attorneys||{data:[]},localDoctors:this.doctors||{data:[]},localPatients:this.patients||{data:[]},isUpdatingData:!1,showSuccessMessage:!1}},computed:{currentUser(){return this.$page.props.auth.user},userRole(){var t,s,r;return(r=(s=(t=this.currentUser)==null?void 0:t.roles)==null?void 0:s[0])==null?void 0:r.name},isAttorney(){return this.userRole==="Attorney"},isDoctor(){return this.userRole==="Doctor"},isCaseManager(){return this.userRole==="Case_manager"},availableStates(){var s,r,h,e,o;if(this.isAttorney&&((s=this.currentUser)!=null&&s.state_id)){const u=(h=(r=this.referralStates)==null?void 0:r.data)==null?void 0:h.find(x=>x.state_id==this.currentUser.state_id);if(u)return[{label:u.name,value:u.state_id}]}return(((e=this.referralStates)==null?void 0:e.data)||((o=this.states)==null?void 0:o.data)||[]).map(u=>({label:u.name,value:u.state_id}))},currentStateName(){const t=this.availableStates.find(s=>s.value==this.form.state_id);return t?t.label:"Not selected"},attorneysData(){var t,s,r;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((r=(s=this.localAttorneys)==null?void 0:s.data)==null?void 0:r.filter(e=>{var o;return((o=e.law_firm)==null?void 0:o.state_id)==this.currentUser.state_id}))||[]}:this.localAttorneys},doctorsData(){var t,s,r;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((r=(s=this.localDoctors)==null?void 0:s.data)==null?void 0:r.filter(e=>{var o;return(o=e.clinics)==null?void 0:o.some(u=>u.state_id==this.currentUser.state_id)}))||[]}:this.localDoctors},patientsData(){var t,s,r;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((r=(s=this.localPatients)==null?void 0:s.data)==null?void 0:r.filter(e=>e.state_id==this.currentUser.state_id))||[]}:this.localPatients}},watch:{"form.attorney.user_id"(t){this.form.attorney_user_id=t},"form.doctor.user_id"(t){this.form.doctor_user_id=t},"form.patient.user_id"(t){this.form.patient_user_id=t},"form.doctor.clinic.clinic_id"(t){this.form.clinic_id=t},"form.state_id"(t,s){var r;if(t&&t!==s){if(this.isAttorney&&((r=this.currentUser)!=null&&r.state_id)&&t!=this.currentUser.state_id){this.form.state_id=this.currentUser.state_id;return}this.updateDataByState(t)}},"form.data()"(){this.showSuccessMessage&&(this.showSuccessMessage=!1)}},methods:{handleInsuranceData(t){this.form.insuranceData=t},handleCloseChange(){this.form.is_closed?this.form.closed_at=new Date().toISOString():this.form.closed_at=null},submitForm(){const t=this.validateForm();if(t.length>0){t.forEach(s=>{this.$toast().error(s)});return}this.showSuccessMessage=!1,this.form.post(this.route(this.storeRoute),{onSuccess:()=>{this.$toast().success("Referral created successfully!"),this.showSuccessMessage=!0,this.form.reset(),this.form.clearErrors()},onError:s=>{this.$toast().error("Failed to create referral. Please check the form and try again.")}})},validateForm(){var s,r,h,e,o,u,x;const t=[];if(this.form.referral_date||t.push("Referral date is required"),this.form.referral_status_id||t.push("Referral status is required"),this.form.state_id||t.push("Referral state is required"),this.form.patient.injury_date||t.push("Injury date is required"),(!this.form.patient.referral_reason_ids||this.form.patient.referral_reason_ids.length===0)&&t.push("At least one referral reason is required"),this.isAttorney&&(!this.form.doctor_user_id&&!this.form.doctor.name&&t.push("Doctor information is required for attorneys"),this.form.doctor.user_id)){const _=(r=(s=this.localDoctors)==null?void 0:s.data)==null?void 0:r.find(m=>m.user_id==this.form.doctor.user_id);_&&((h=this.currentUser)!=null&&h.state_id)&&((e=_.clinics)!=null&&e.some(v=>v.state_id==this.currentUser.state_id)||t.push("Selected doctor must be from your assigned state"))}if(!this.form.patient_user_id&&!this.form.patient.name&&t.push("Patient information is required"),this.isAttorney&&this.form.patient.user_id&&((o=this.currentUser)!=null&&o.state_id)){const _=(x=(u=this.localPatients)==null?void 0:u.data)==null?void 0:x.find(m=>m.user_id==this.form.patient.user_id);_&&_.state_id!=this.currentUser.state_id&&t.push("Selected patient must be from your assigned state")}return t},isFormReady(){var s,r,h,e,o,u,x,_,m,v,D,A,y,R,S,j;console.log("isFormReady check:",{referral_date:this.form.referral_date,referral_status_id:this.form.referral_status_id,state_id:this.form.state_id,patient_injury_date:(s=this.form.patient)==null?void 0:s.injury_date,patient_referral_reason_ids:(r=this.form.patient)==null?void 0:r.referral_reason_ids,patient_name:(h=this.form.patient)==null?void 0:h.name,patient_user_id:this.form.patient_user_id,doctor_user_id:this.form.doctor_user_id,doctor_name:(e=this.form.doctor)==null?void 0:e.name,attorney_user_id:this.form.attorney_user_id,attorney_name:(o=this.form.attorney)==null?void 0:o.name,localDoctors_length:(x=(u=this.localDoctors)==null?void 0:u.data)==null?void 0:x.length,localPatients_length:(m=(_=this.localPatients)==null?void 0:_.data)==null?void 0:m.length});const t=["referral_date","referral_status_id","state_id"];for(const V of t)if(!this.form[V])return console.log(`Field ${V} is missing:`,this.form[V]),!1;if(!((v=this.form.patient)!=null&&v.injury_date))return console.log("Patient injury_date is missing"),!1;if(!((D=this.form.patient)!=null&&D.referral_reason_ids)||this.form.patient.referral_reason_ids.length===0)return console.log("Patient referral_reason_ids is missing or empty:",(A=this.form.patient)==null?void 0:A.referral_reason_ids),!1;if(this.form.state_id){if(((R=(y=this.localDoctors)==null?void 0:y.data)==null?void 0:R.length)===0)return console.log("No doctors available for selected state"),!1;if(((j=(S=this.localPatients)==null?void 0:S.data)==null?void 0:j.length)===0)return console.log("No patients available for selected state"),!1}return this.isDoctor&&!this.form.attorney_user_id&&!this.form.attorney.name?(console.log("Doctor role: attorney information is missing"),!1):this.isAttorney&&!this.form.doctor_user_id&&!this.form.doctor.name?(console.log("Attorney role: doctor information is missing"),!1):!this.form.patient_user_id&&!this.form.patient.name?(console.log("Patient information is missing"),!1):(console.log("Form is ready!"),!0)},getCptLabel(t){const r=(Array.isArray(this.CptCodes)?this.CptCodes:[]).find(h=>h.id===t);return r?`${r.code} - ${r.description}`:"Unknown"},removeCptCode(t){this.form.selectedCptCodes=this.form.selectedCptCodes.filter(s=>s!==t),this.onFormFieldChange()},triggerAutoSelection(){var t,s,r,h,e,o,u,x,_,m,v,D,A,y,R,S,j,V,q,U,d,w,O,z,N,B,L,T,E,H;if(this.isAttorney){const c=(((t=this.attorneys)==null?void 0:t.data)||[]).find(I=>I.user_id===this.currentUser.user_id);c?(this.form.attorney_user_id=c.user_id,this.form.attorney={name:c.name,email:c.email,phone_number:c.phone_number||"",user_id:c.user_id,law_firm:{name:((s=c.law_firm)==null?void 0:s.name)||"",email:((r=c.law_firm)==null?void 0:r.email)||"",phone_number:((h=c.law_firm)==null?void 0:h.phone_number)||"",address_line_1:((e=c.law_firm)==null?void 0:e.address_line_1)||"",address_line_2:((o=c.law_firm)==null?void 0:o.address_line_2)||"",city:((u=c.law_firm)==null?void 0:u.city)||"",state_id:((x=c.law_firm)==null?void 0:x.state_id)||this.currentUser.state_id||"",zip_code:((_=c.law_firm)==null?void 0:_.zip_code)||""}},this.onFormFieldChange()):this.$toast().warning("Attorney data not found. Please contact administrator.")}else if(this.isDoctor){const c=(((m=this.doctors)==null?void 0:m.data)||[]).find(I=>I.user_id===this.currentUser.user_id);c?(this.form.doctor_user_id=c.user_id,this.form.clinic_id=((D=(v=c.clinics)==null?void 0:v[0])==null?void 0:D.clinic_id)||"",this.form.doctor={user_id:c.user_id,name:c.name,email:c.email,phone_number:c.phone_number||"",medical_specialty_id:c.medical_specialty_id||null,clinic:{clinic_id:((y=(A=c.clinics)==null?void 0:A[0])==null?void 0:y.clinic_id)||"",name:((S=(R=c.clinics)==null?void 0:R[0])==null?void 0:S.name)||"",email:((V=(j=c.clinics)==null?void 0:j[0])==null?void 0:V.email)||"",phone_number:((U=(q=c.clinics)==null?void 0:q[0])==null?void 0:U.phone_number)||"",address_line_1:((w=(d=c.clinics)==null?void 0:d[0])==null?void 0:w.address_line_1)||"",address_line_2:((z=(O=c.clinics)==null?void 0:O[0])==null?void 0:z.address_line_2)||"",city:((B=(N=c.clinics)==null?void 0:N[0])==null?void 0:B.city)||"",state_id:((T=(L=c.clinics)==null?void 0:L[0])==null?void 0:T.state_id)||this.currentUser.state_id||"",zip_code:((H=(E=c.clinics)==null?void 0:E[0])==null?void 0:H.zip_code)||""},notes:""},this.onFormFieldChange()):this.$toast().warning("Doctor data not found. Please contact administrator.")}},clearSuccessMessage(){this.showSuccessMessage=!1},resetForm(){this.form.reset(),this.form.clearErrors(),this.showSuccessMessage=!1,this.initializeFormState()},onFormFieldChange(){this.showSuccessMessage&&(this.showSuccessMessage=!1)},updateDataByState(t){t&&(this.isUpdatingData=!0,this.onFormFieldChange(),this.fetchDataByState(t))},async fetchDataByState(t){try{const s=await fetch(this.route("referrals.data-by-state",{state_id:t}),{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.ok){const r=await s.json();r.attorneys&&Array.isArray(r.attorneys.data)&&(this.localAttorneys=r.attorneys),r.doctors&&Array.isArray(r.doctors.data)&&(this.localDoctors=r.doctors),r.patients&&Array.isArray(r.patients.data)&&(this.localPatients=r.patients)}else console.error("Failed to fetch data for state:",t,s.status,s.statusText)}catch(s){console.error("Error fetching data for state:",s)}finally{this.isUpdatingData=!1}},initializeFormState(){var t,s;(t=this.currentUser)!=null&&t.state_id&&!this.form.state_id&&(this.form.state_id=this.currentUser.state_id),this.isAttorney&&((s=this.currentUser)!=null&&s.state_id)&&(this.form.state_id=this.currentUser.state_id)},getCptCodeOptions(){return(Array.isArray(this.CptCodes)?this.CptCodes:[]).map(s=>({label:`${s.code} - ${s.description}`,value:s.id}))}},mounted(){this.localAttorneys=this.attorneys||{data:[]},this.localDoctors=this.doctors||{data:[]},this.localPatients=this.patients||{data:[]},this.$nextTick(()=>{this.triggerAutoSelection(),this.initializeFormState()})}},P=t=>(ie("data-v-06076f99"),t=t(),ae(),t),Oe={key:0,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md"},Ie={class:"flex"},Me=P(()=>l("div",{class:"flex-shrink-0"},[l("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),ze={class:"ml-3"},Ne=P(()=>l("h3",{class:"text-sm font-medium text-red-800"},"Please fix the following errors:",-1)),Be={class:"mt-2 text-sm text-red-700"},Le={class:"list-disc pl-5 space-y-1"},Te={key:1,class:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md"},Ee=P(()=>l("div",{class:"flex"},[l("div",{class:"flex-shrink-0"},[l("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM5.293 9.293a1 1 0 011.414 0L9 11.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])]),l("div",{class:"ml-3"},[l("h3",{class:"text-sm font-medium text-green-800"},"Referral created successfully!"),l("div",{class:"mt-2 text-sm text-green-700"}," Your referral has been submitted and is now being processed. ")])],-1)),He=[Ee],We={class:"h-full divide-y divide-gray-200 space-y-12"},Xe=P(()=>l("span",{class:"text-blue-500 italic"},"Referral State",-1)),Ye={class:"flex items-center gap-2"},Ge={key:0,class:"flex items-center gap-2 text-sm text-gray-500"},Je=P(()=>l("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"},null,-1)),Ke={key:1,class:"text-sm text-gray-500 italic"},Qe={key:0,class:"mt-2 text-sm text-blue-600 bg-blue-50 p-2 rounded"},Ze=P(()=>l("strong",null,"Note:",-1)),$e={key:2,class:"text-sm text-gray-600 mt-1"},et={key:0,class:"selected-codes"},tt=["onClick"],rt={class:"col-span-full bg-white rounded-lg shadow-sm border border-gray-200 p-6"},st=P(()=>l("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Referral Reasons",-1)),ot={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},it=["id","value"],at=["for"],lt=["value"];function nt(t,s,r,h,e,o){const u=b("v-form-label"),x=b("v-form-input"),_=b("v-form-error"),m=b("v-form-group"),v=b("v-form-select"),D=b("v-content-body"),A=b("x-policy-form"),y=b("x-referral-doctor-form"),R=b("x-referral-patient-form"),S=b("x-referral-attorney-form"),j=b("x-referral-documents-form"),V=b("v-button"),q=b("v-form");return n(),F(q,{class:"h-full",onSubmit:Q(o.submitForm,["prevent"])},{default:a(()=>{var U;return[Object.keys(e.form.errors).length>0?(n(),C("div",Oe,[l("div",Ie,[Me,l("div",ze,[Ne,l("div",Be,[l("ul",Le,[(n(!0),C(M,null,W(e.form.errors,(d,w)=>(n(),C("li",{key:w},k(d),1))),128))])])])])])):g("",!0),e.showSuccessMessage?(n(),C("div",Te,He)):g("",!0),l("div",We,[l("div",null,[i(D,{class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"},{default:a(()=>[i(m,null,{default:a(()=>[i(u,null,{default:a(()=>[f("Referral Date")]),_:1}),i(x,{type:"date",modelValue:e.form.referral_date,"onUpdate:modelValue":s[0]||(s[0]=d=>e.form.referral_date=d),error:e.form.errors.referral_date,disabled:e.form.processing,onChange:o.onFormFieldChange},null,8,["modelValue","error","disabled","onChange"]),e.form.errors.referral_date?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors.referral_date),1)]),_:1})):g("",!0)]),_:1}),i(m,null,{default:a(()=>{var d;return[i(u,null,{default:a(()=>[f("Referral Status")]),_:1}),i(v,{options:(((d=r.referralStatuses)==null?void 0:d.data)||[]).map(w=>({label:w.name,value:w.referral_status_id})),error:e.form.errors.referral_status_id,disabled:e.form.processing,required:!0,modelValue:e.form.referral_status_id,"onUpdate:modelValue":s[1]||(s[1]=w=>e.form.referral_status_id=w),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.referral_status_id?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors.referral_status_id),1)]),_:1})):g("",!0)]}),_:1}),i(m,null,{default:a(()=>[i(u,null,{default:a(()=>[f("Injury Date")]),_:1}),i(x,{type:"date",modelValue:e.form.patient.injury_date,"onUpdate:modelValue":s[2]||(s[2]=d=>e.form.patient.injury_date=d),error:e.form.errors["patient.injury_date"],disabled:e.form.processing,required:!0,onChange:o.onFormFieldChange},null,8,["modelValue","error","disabled","onChange"]),e.form.errors["patient.injury_date"]?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors["patient.injury_date"]),1)]),_:1})):g("",!0)]),_:1}),i(m,{class:"col-span-full md:col-span-2"},{default:a(()=>[i(u,null,{default:a(()=>[Xe]),_:1}),l("div",Ye,[i(v,{options:o.availableStates,error:e.form.errors.state_id,disabled:e.form.processing||o.isAttorney,required:!0,modelValue:e.form.state_id,"onUpdate:modelValue":s[3]||(s[3]=d=>e.form.state_id=d),onChange:o.onFormFieldChange,class:"flex-1"},null,8,["options","error","disabled","modelValue","onChange"]),e.isUpdatingData?(n(),C("div",Ge,[Je,f(" Updating... ")])):g("",!0),o.isAttorney?(n(),C("div",Ke," (Attorney's state) ")):g("",!0)]),o.isAttorney?(n(),C("div",Qe,[Ze,f(" As an attorney, you can only create referrals within your assigned state. Only doctors and patients from your state will be available for selection. ")])):g("",!0),e.form.errors.state_id?(n(),F(_,{key:1},{default:a(()=>[f(k(e.form.errors.state_id),1)]),_:1})):g("",!0),e.form.state_id?(n(),C("div",$e," Selected: "+k(o.currentStateName),1)):g("",!0)]),_:1}),i(m,null,{default:a(()=>[i(u,null,{default:a(()=>[f("CPT Codes")]),_:1}),i(v,{options:o.getCptCodeOptions(),error:e.form.errors.cpt_code_id,disabled:e.form.processing,required:!0,multiple:"",modelValue:e.form.selectedCptCodes,"onUpdate:modelValue":s[4]||(s[4]=d=>e.form.selectedCptCodes=d),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.selectedCptCodes.length?(n(),C("div",et,[(n(!0),C(M,null,W(e.form.selectedCptCodes,(d,w)=>(n(),C("span",{key:w,class:"badge"},[f(k(o.getCptLabel(d))+" ",1),l("button",{type:"button",onClick:O=>o.removeCptCode(d),class:"remove-btn"},"Ã—",8,tt)]))),128))])):g("",!0),e.form.errors.cpt_code_id?(n(),F(_,{key:1},{default:a(()=>[f(k(e.form.errors.cpt_code_id),1)]),_:1})):g("",!0)]),_:1}),i(m,null,{default:a(()=>{var d;return[i(u,null,{default:a(()=>[f("Piloting Physician")]),_:1}),i(v,{options:(((d=r.physicians)==null?void 0:d.data)||[]).map(w=>({label:w.name,value:w.user_id})),error:e.form.errors.doctor_user_id,disabled:e.form.processing,required:!0,modelValue:e.form.doctor_user_id,"onUpdate:modelValue":s[5]||(s[5]=w=>e.form.doctor_user_id=w),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.doctor_user_id?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors.doctor_user_id),1)]),_:1})):g("",!0)]}),_:1}),i(m,null,{default:a(()=>[i(u,null,{default:a(()=>[f("Billing Type")]),_:1}),i(v,{options:["LOP","Insurance"].map(d=>({label:d,value:d})),error:e.form.errors.billing_type,disabled:e.form.processing,required:!0,modelValue:e.form.billing_type,"onUpdate:modelValue":s[6]||(s[6]=d=>e.form.billing_type=d),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.billing_type?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors.billing_type),1)]),_:1})):g("",!0)]),_:1})]),_:1})]),i(A,{"onUpdate:insuranceData":o.handleInsuranceData},null,8,["onUpdate:insuranceData"]),i(y,{attorneys:o.doctorsData,doctors:o.doctorsData,"document-categories":r.documentCategories,form:e.form,"medical-specialties":r.medicalSpecialties,patients:o.patientsData,"referral-reasons":r.referralReasons,"referral-statuses":r.referralStatuses,states:r.states},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states"]),i(R,{attorneys:o.attorneysData,doctors:o.doctorsData,"document-categories":r.documentCategories,form:e.form,"medical-specialties":r.medicalSpecialties,patients:o.patientsData,"referral-reasons":r.referralReasons,"referral-statuses":r.referralStatuses,states:r.states,icdCodes:r.icdCodes},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states","icdCodes"]),l("div",rt,[st,l("div",ot,[(n(!0),C(M,null,W(((U=r.referralReasons)==null?void 0:U.data)||[],d=>(n(),C("div",{key:d.referral_reason_id,class:"flex items-center"},[re(l("input",{type:"checkbox",id:"reason_"+d.referral_reason_id,value:d.referral_reason_id,"onUpdate:modelValue":s[7]||(s[7]=w=>e.form.patient.referral_reason_ids=w),onChange:s[8]||(s[8]=(...w)=>o.onFormFieldChange&&o.onFormFieldChange(...w)),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,40,it),[[se,e.form.patient.referral_reason_ids]]),l("label",{for:"reason_"+d.referral_reason_id,class:"ml-2 text-sm text-gray-700"},k(d.name),9,at)]))),128))]),e.form.errors["patient.referral_reason_ids"]?(n(),F(_,{key:0},{default:a(()=>[f(k(e.form.errors["patient.referral_reason_ids"]),1)]),_:1})):g("",!0)]),i(S,{attorneys:o.attorneysData,form:e.form,"user-role":o.userRole,patients:o.patientsData,"referral-reasons":r.referralReasons,states:r.states},null,8,["attorneys","form","user-role","patients","referral-reasons","states"]),i(j,{attorneys:r.attorneys,doctors:r.doctors,"document-categories":r.documentCategories,form:e.form,"medical-specialties":r.medicalSpecialties,patients:r.patients,"referral-reasons":r.referralReasons,"referral-statuses":r.referralStatuses,states:r.states},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states"]),i(m,{class:"col-span-full flex items-center justify-end gap-2 text-right border-t border-gray-200 bg-gray-50 px-6 py-4"},{default:a(()=>[e.form.progress?(n(),C("progress",{key:0,value:e.form.progress.percentage,max:"100"},k(e.form.progress.percentage)+"% ",9,lt)):g("",!0),i(V,{href:t.route(r.listRoute),color:"white",disabled:e.form.processing},{default:a(()=>[f(" Cancel ")]),_:1},8,["href","disabled"]),i(V,{onClick:o.resetForm,color:"gray",disabled:e.form.processing},{default:a(()=>[f(" Reset ")]),_:1},8,["onClick","disabled"]),i(V,{disabled:e.form.processing||!o.isFormReady(),class:oe({"opacity-50":!o.isFormReady()})},{default:a(()=>[f(k(o.isFormReady()?"Create Referral":"Please fill required fields"),1)]),_:1},8,["disabled","class"])]),_:1})])]}),_:1},8,["onSubmit"])}const _t=Y(Pe,[["render",nt],["__scopeId","data-v-06076f99"]]);export{_t as R};
