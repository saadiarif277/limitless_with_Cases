import{R as Z,a as $,b as ee}from"./_referral-patient-form-D83R-Jm0.js";import{r as b,o as n,c as k,a as i,w as a,g as l,F as M,i as H,b as _,t as y,e as D,d as X,f as g,T as te,l as re,s as se,n as oe,p as ie,k as ae}from"./app-D0YmfmiQ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={props:{attorneys:{type:Object,required:!0,default:()=>{}},doctors:{type:Object,required:!0,default:()=>{}},documentCategories:{type:Object,required:!0,default:()=>{}},form:{type:Object,required:!0,default:()=>{}},medicalSpecialties:{type:Object,required:!0,default:()=>{}},patients:{type:Object,required:!0,default:()=>{}},referralReasons:{type:Object,required:!1,default:()=>{}},referralStatuses:{type:Object,required:!1,default:()=>{}},states:{type:Object,required:!1,default:()=>{}}},computed:{processedDocumentCategories(){var r,s;if(!((r=this.documentCategories)!=null&&r.data))return[];let t=[];return(s=this.documentCategories.data)!=null&&s.data&&Array.isArray(this.documentCategories.data.data)?t=this.documentCategories.data.data:Array.isArray(this.documentCategories.data)&&(t=this.documentCategories.data),t.length===0?[]:t}}},ne={class:"divide-y divide-gray-200"},de=l("div",{class:"flex items-center gap-2"},[l("div",{class:"flex items-center gap-2"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 text-pink-500"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"})]),l("span",{class:"text-pink-500"},"Document"),_(" Information ")])],-1),ce={class:"relative grid grid-cols-1 gap-4"},ue={key:0,class:"space-y-1"},_e={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"},me={key:0,class:"text-gray-500 italic text-sm"},fe=l("span",{class:"text-red-500 uppercase"}," Cancel ",-1),pe={key:0,class:"text-center py-8"},he=l("p",{class:"text-gray-500"},"No document categories available for your role.",-1),ge=l("p",{class:"text-sm text-gray-400 mt-2"},"If you believe this is an error, please contact your administrator.",-1),ye={key:0,class:"mt-4 p-4 bg-gray-100 rounded text-left text-xs"},be=l("p",null,[l("strong",null,"Debug Info:")],-1);function ve(t,r,s,f,e,o){const u=b("v-section-heading"),w=b("v-link"),m=b("v-form-label"),p=b("v-form-file"),v=b("v-paragraph"),A=b("v-form-group"),F=b("v-content-body"),C=b("v-card");return n(),k("div",ne,[i(F,null,{default:a(()=>{var U,j;return[i(u,null,{title:a(()=>[de]),_:1}),l("div",ce,[(n(!0),k(M,null,H(o.processedDocumentCategories,(V,R)=>(n(),k(M,{key:"documentCategory_"+R},[V.document_types&&V.document_types.length?(n(),k("div",ue,[i(u,null,{title:a(()=>[_(y(V.name),1)]),_:2},1024),l("div",_e,[(n(!0),k(M,null,H(V.document_types,(S,q)=>(n(),D(C,{key:"documentType_"+q},{default:a(()=>[i(F,null,{default:a(()=>[i(A,null,{default:a(()=>[i(m,{class:"flex items-center justify-between"},{default:a(()=>[_(y(S.name)+" ",1),!S.can_upload&&!S.is_generated?(n(),k("span",me,"Upload Restricted")):s.form.documents[S.document_type_id]?(n(),D(w,{key:1,href:"#",onClick:X(d=>s.form.documents[S.document_type_id]=null,["stop"])},{default:a(()=>[fe]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024),i(p,{modelValue:s.form.documents[S.document_type_id],"onUpdate:modelValue":d=>s.form.documents[S.document_type_id]=d,disabled:!S.can_upload||S.is_generated},null,8,["modelValue","onUpdate:modelValue","disabled"]),!S.can_upload&&!S.is_generated?(n(),D(v,{key:0,class:"text-sm text-gray-500 italic mt-2"},{default:a(()=>[_(" You don't have permission to upload this document type. ")]),_:1})):g("",!0),S.is_generated?(n(),D(v,{key:1,class:"text-sm text-gray-500 italic mt-2"},{default:a(()=>[_(" This document is generated by the system. ")]),_:1})):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])])):g("",!0)],64))),128)),!o.processedDocumentCategories||o.processedDocumentCategories.length===0?(n(),k("div",pe,[he,ge,s.documentCategories?(n(),k("div",ye,[be,l("p",null,"documentCategories type: "+y(typeof s.documentCategories),1),l("p",null,"documentCategories.data type: "+y(typeof s.documentCategories.data),1),l("p",null,"documentCategories.data.data type: "+y(typeof((U=s.documentCategories.data)==null?void 0:U.data)),1),l("p",null,"documentCategories.data.data length: "+y((j=s.documentCategories.data)!=null&&j.data?Array.isArray(s.documentCategories.data.data)?s.documentCategories.data.data.length:"Not an array":"No nested data"),1),l("p",null,"documentCategories.data length: "+y(s.documentCategories.data?Array.isArray(s.documentCategories.data)?s.documentCategories.data.length:"Not an array":"No data"),1),l("p",null,"Raw data: "+y(JSON.stringify(s.documentCategories,null,2)),1)])):g("",!0)])):g("",!0)])]}),_:1})])}const Ce=G(le,[["render",ve]]),xe={props:{items:{type:Array,default:()=>[]}},data(){return{form:{policy_limit:"",pip:"",defendant_insurance:"",plaintiff_insurance:"",commercial_case:!1,type_of_accident:"",errors:{},processing:!1},typeOfAccidentOptions:[{label:"Motor Vehicle Accident",value:"motor_vehicle"},{label:"Workplace Accident",value:"workplace"},{label:"Medical Malpractice",value:"medical_malpractice"},{label:"Slip and Fall",value:"slip_and_fall"}]}},methods:{filterItems(){this.items.filter(t=>t.someCondition)},updateParent(){this.$emit("update:insuranceData",{...this.form})},submitForm(){this.form.processing=!0,setTimeout(()=>{this.form.processing=!1,alert("Form submitted!")},2e3)}}},ke={class:"divide-y divide-gray-200"},we=l("div",{class:"flex items-center gap-2"},[l("div",{class:"flex items-center gap-2"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 text-primary-500"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"})]),l("span",{class:"text-dark-500"},"Insurance"),_(" Information ")])],-1),Se=l("span",{class:"text-dark-500 italic"},"Policy Limit",-1),Ae=l("span",{class:"text-dark-500 italic"},"PIP",-1),De=l("span",{class:"text-dark-500 italic"},"Defendant Insurance",-1),Fe=l("span",{class:"text-dark-500 italic"},"Plaintiff Insurance",-1),Ve=l("span",{class:"text-dark-500 italic"},"Type of Accident",-1);function Re(t,r,s,f,e,o){const u=b("v-section-heading"),w=b("v-content-body"),m=b("v-form-label"),p=b("v-form-input"),v=b("v-form-error"),A=b("v-form-group"),F=b("v-form-select");return n(),k("div",ke,[i(w,null,{default:a(()=>[i(u,null,{title:a(()=>[we]),_:1})]),_:1}),i(w,{class:"relative grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-6 gap-4"},{default:a(()=>[i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[Se]),_:1}),i(p,{type:"number",modelValue:e.form.policy_limit,"onUpdate:modelValue":r[0]||(r[0]=C=>e.form.policy_limit=C),error:e.form.errors.policy_limit,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.policy_limit?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.policy_limit),1)]),_:1})):g("",!0)]),_:1}),i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[Ae]),_:1}),i(p,{type:"number",modelValue:e.form.pip,"onUpdate:modelValue":r[1]||(r[1]=C=>e.form.pip=C),error:e.form.errors.pip,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.pip?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.pip),1)]),_:1})):g("",!0)]),_:1}),i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[De]),_:1}),i(p,{type:"text",modelValue:e.form.defendant_insurance,"onUpdate:modelValue":r[2]||(r[2]=C=>e.form.defendant_insurance=C),error:e.form.errors.defendant_insurance,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.defendant_insurance?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.defendant_insurance),1)]),_:1})):g("",!0)]),_:1}),i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[Fe]),_:1}),i(p,{type:"text",modelValue:e.form.plaintiff_insurance,"onUpdate:modelValue":r[3]||(r[3]=C=>e.form.plaintiff_insurance=C),error:e.form.errors.plaintiff_insurance,onInput:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["modelValue","error","onInput"]),e.form.errors.plaintiff_insurance?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.plaintiff_insurance),1)]),_:1})):g("",!0)]),_:1}),i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[_("Is it a Commercial Case?")]),_:1}),i(F,{options:[{label:"Yes",value:!0},{label:"No",value:!1}],error:e.form.errors.commercial_case,disabled:e.form.processing,required:!0,modelValue:e.form.commercial_case,"onUpdate:modelValue":r[4]||(r[4]=C=>e.form.commercial_case=C)},null,8,["error","disabled","modelValue"]),e.form.errors.commercial_case?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.commercial_case),1)]),_:1})):g("",!0)]),_:1}),i(A,{class:"col-span-full sm:col-span-2 xl:col-span-3"},{default:a(()=>[i(m,null,{default:a(()=>[Ve]),_:1}),i(F,{options:e.typeOfAccidentOptions,modelValue:e.form.type_of_accident,"onUpdate:modelValue":r[5]||(r[5]=C=>e.form.type_of_accident=C),error:e.form.errors.type_of_accident,onChange:o.updateParent,class:"border border-gray-300 rounded-lg"},null,8,["options","modelValue","error","onChange"]),e.form.errors.type_of_accident?(n(),D(v,{key:0},{default:a(()=>[_(y(e.form.errors.type_of_accident),1)]),_:1})):g("",!0)]),_:1})]),_:1})])}const Ue=G(xe,[["render",Re]]),je={name:"ReferralsCreateForm",components:{"x-referral-attorney-form":Z,"x-referral-doctor-form":$,"x-referral-documents-form":Ce,"x-referral-patient-form":ee,"x-policy-form":Ue},props:{attorneys:{type:Object,required:!0},doctors:{type:Object,required:!0},physicians:{type:Object,required:!0},documentCategories:{type:Object,required:!1},medicalSpecialties:{type:Object,required:!0},patients:{type:Object,required:!0},referralReasons:{type:Object,required:!1},referralStatuses:{type:Object,required:!1},referralStates:{type:Object,required:!1},states:{type:Object,required:!1},listRoute:{type:String,default:"panel.admin.referrals.index"},storeRoute:{type:String,default:"panel.admin.referrals.store"},icdCodes:{type:Object,required:!1},CptCodes:{type:Object,required:!1},selectedStateId:{type:[String,Number],required:!1,default:null}},data(){var e,o,u,w,m,p,v,A,F,C,U,j,V,R,S,q,d,x,O,z,N,L,B,E,W,Y,c,I,K,Q,T;const t=this.$page.props.auth.user,r=(o=(e=t==null?void 0:t.roles)==null?void 0:e[0])==null?void 0:o.name;let s=null,f=null;if(r==="Attorney"){const h=(((u=this.attorneys)==null?void 0:u.data)||[]).find(J=>J.user_id===t.user_id);h&&(s={name:h.name,email:h.email,phone_number:h.phone_number||"",user_id:h.user_id,law_firm:{name:((w=h.law_firm)==null?void 0:w.name)||"",email:((m=h.law_firm)==null?void 0:m.email)||"",phone_number:((p=h.law_firm)==null?void 0:p.phone_number)||"",address_line_1:((v=h.law_firm)==null?void 0:v.address_line_1)||"",address_line_2:((A=h.law_firm)==null?void 0:A.address_line_2)||"",city:((F=h.law_firm)==null?void 0:F.city)||"",state_id:((C=h.law_firm)==null?void 0:C.state_id)||t.state_id||"",zip_code:((U=h.law_firm)==null?void 0:U.zip_code)||""}})}else if(r==="Doctor"){const h=(((j=this.doctors)==null?void 0:j.data)||[]).find(J=>J.user_id===t.user_id);h&&(f={user_id:h.user_id,name:h.name,email:h.email,phone_number:h.phone_number||"",medical_specialty_id:h.medical_specialty_id||null,clinic:{clinic_id:((R=(V=h.clinics)==null?void 0:V[0])==null?void 0:R.clinic_id)||"",name:((q=(S=h.clinics)==null?void 0:S[0])==null?void 0:q.name)||"",email:((x=(d=h.clinics)==null?void 0:d[0])==null?void 0:x.email)||"",phone_number:((z=(O=h.clinics)==null?void 0:O[0])==null?void 0:z.phone_number)||"",address_line_1:((L=(N=h.clinics)==null?void 0:N[0])==null?void 0:L.address_line_1)||"",address_line_2:((E=(B=h.clinics)==null?void 0:B[0])==null?void 0:E.address_line_2)||"",city:((Y=(W=h.clinics)==null?void 0:W[0])==null?void 0:Y.city)||"",state_id:((I=(c=h.clinics)==null?void 0:c[0])==null?void 0:I.state_id)||t.state_id||"",zip_code:((Q=(K=h.clinics)==null?void 0:K[0])==null?void 0:Q.zip_code)||""},notes:""})}return{form:te({referral_date:new Date().toISOString().split("T")[0],referral_status_id:1,state_id:(t==null?void 0:t.state_id)||"",attorney_user_id:(s==null?void 0:s.user_id)||"",doctor_user_id:(f==null?void 0:f.user_id)||"",patient_user_id:"",clinic_id:((T=f==null?void 0:f.clinic)==null?void 0:T.clinic_id)||"",attorney:s||{name:"",email:"",phone_number:"",user_id:"",law_firm:{name:"",email:"",phone_number:"",address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""}},doctor:f||{user_id:"",name:"",email:"",phone_number:"",medical_specialty_id:null,clinic:{clinic_id:"",name:"",email:"",phone_number:"",address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""},notes:""},patient:{name:"",email:"",phone_number:"",user_id:"",height:"",weight:"",gender:"",birthdate:"",injury_date:new Date().toISOString().split("T")[0],referral_reason_ids:[],address_line_1:"",address_line_2:"",city:"",state_id:(t==null?void 0:t.state_id)||"",zip_code:""},documents:{},selectedCptCodes:[],insuranceData:{},billing_type:"",is_cms1500_generated:!1,case_won:!1,outcome:"",reduction_accepted:!1,is_closed:!1,closed_at:null,created_at:null,updated_at:null}),localAttorneys:this.attorneys||{data:[]},localDoctors:this.doctors||{data:[]},localPatients:this.patients||{data:[]},isUpdatingData:!1,showSuccessMessage:!1}},computed:{currentUser(){return this.$page.props.auth.user},userRole(){var t,r,s;return(s=(r=(t=this.currentUser)==null?void 0:t.roles)==null?void 0:r[0])==null?void 0:s.name},isAttorney(){return this.userRole==="Attorney"},isDoctor(){return this.userRole==="Doctor"},isCaseManager(){return this.userRole==="Case_manager"},isAdmin(){return this.userRole==="Administrator"||this.userRole==="Admin"},availableStates(){var r,s,f,e,o;if(this.isAttorney&&((r=this.currentUser)!=null&&r.state_id)){const u=(f=(s=this.referralStates)==null?void 0:s.data)==null?void 0:f.find(w=>w.state_id==this.currentUser.state_id);if(u)return[{label:u.name,value:u.state_id}]}return(((e=this.referralStates)==null?void 0:e.data)||((o=this.states)==null?void 0:o.data)||[]).map(u=>({label:u.name,value:u.state_id}))},currentStateName(){const t=this.availableStates.find(r=>r.value==this.form.state_id);return t?t.label:"Not selected"},attorneysData(){var t,r,s;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((s=(r=this.localAttorneys)==null?void 0:r.data)==null?void 0:s.filter(e=>{var o;return((o=e.law_firm)==null?void 0:o.state_id)==this.currentUser.state_id}))||[]}:this.isAdmin?this.localAttorneys:this.localAttorneys},doctorsData(){var t,r,s;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((s=(r=this.localDoctors)==null?void 0:r.data)==null?void 0:s.filter(e=>{var o;return(o=e.clinics)==null?void 0:o.some(u=>u.state_id==this.currentUser.state_id)}))||[]}:this.isAdmin?this.localDoctors:this.localDoctors},patientsData(){var t,r,s;return this.isAttorney&&((t=this.currentUser)!=null&&t.state_id)?{data:((s=(r=this.localPatients)==null?void 0:r.data)==null?void 0:s.filter(e=>e.state_id==this.currentUser.state_id))||[]}:this.isAdmin?this.localPatients:this.localPatients}},watch:{"form.attorney.user_id"(t){this.form.attorney_user_id=t},"form.doctor.user_id"(t){this.form.doctor_user_id=t},"form.patient.user_id"(t){this.form.patient_user_id=t},"form.doctor.clinic.clinic_id"(t){this.form.clinic_id=t},"form.state_id"(t,r){var s;if(t&&t!==r){if(this.isAttorney&&((s=this.currentUser)!=null&&s.state_id)&&t!=this.currentUser.state_id){this.form.state_id=this.currentUser.state_id;return}(this.isAdmin||!this.isAttorney)&&this.redirectWithState(t)}},"form.doctor.user_id"(t){var r,s;if(t){const f=(s=(r=this.doctorsData)==null?void 0:r.data)==null?void 0:s.find(e=>e.user_id==t);f&&(this.form.doctor.medical_specialty_id=f.medical_specialty_id||1)}},"form.data()"(){this.showSuccessMessage&&(this.showSuccessMessage=!1)}},methods:{handleInsuranceData(t){this.form.insuranceData=t},handleCloseChange(){this.form.is_closed?this.form.closed_at=new Date().toISOString():this.form.closed_at=null},submitForm(){const t=this.validateForm();if(t.length>0){t.forEach(r=>{this.$toast().error(r)});return}this.showSuccessMessage=!1,this.form.post(this.route(this.storeRoute),{onSuccess:()=>{this.$toast().success("Referral created successfully!"),this.showSuccessMessage=!0,this.form.reset(),this.form.clearErrors()},onError:r=>{this.$toast().error("Failed to create referral. Please check the form and try again.")}})},validateForm(){var r,s,f,e,o,u,w;const t=[];if(this.form.referral_date||t.push("Referral date is required"),this.form.referral_status_id||t.push("Referral status is required"),this.form.state_id||t.push("Referral state is required"),this.form.patient.injury_date||t.push("Injury date is required"),(!this.form.patient.referral_reason_ids||this.form.patient.referral_reason_ids.length===0)&&t.push("At least one referral reason is required"),this.isAttorney&&(!this.form.doctor_user_id&&!this.form.doctor.name&&t.push("Doctor information is required for attorneys"),this.form.doctor.user_id)){const m=(s=(r=this.localDoctors)==null?void 0:r.data)==null?void 0:s.find(p=>p.user_id==this.form.doctor.user_id);m&&((f=this.currentUser)!=null&&f.state_id)&&((e=m.clinics)!=null&&e.some(v=>v.state_id==this.currentUser.state_id)||t.push("Selected doctor must be from your assigned state"))}if(!this.form.patient_user_id&&!this.form.patient.name&&t.push("Patient information is required"),this.isAttorney&&this.form.patient.user_id&&((o=this.currentUser)!=null&&o.state_id)){const m=(w=(u=this.localPatients)==null?void 0:u.data)==null?void 0:w.find(p=>p.user_id==this.form.patient.user_id);m&&m.state_id!=this.currentUser.state_id&&t.push("Selected patient must be from your assigned state")}return t},isFormReady(){var r,s,f,e,o,u,w,m,p,v,A,F,C,U,j,V;console.log("isFormReady check:",{referral_date:this.form.referral_date,referral_status_id:this.form.referral_status_id,state_id:this.form.state_id,patient_injury_date:(r=this.form.patient)==null?void 0:r.injury_date,patient_referral_reason_ids:(s=this.form.patient)==null?void 0:s.referral_reason_ids,patient_name:(f=this.form.patient)==null?void 0:f.name,patient_user_id:this.form.patient_user_id,doctor_user_id:this.form.doctor_user_id,doctor_name:(e=this.form.doctor)==null?void 0:e.name,attorney_user_id:this.form.attorney_user_id,attorney_name:(o=this.form.attorney)==null?void 0:o.name,localDoctors_length:(w=(u=this.localDoctors)==null?void 0:u.data)==null?void 0:w.length,localPatients_length:(p=(m=this.localPatients)==null?void 0:m.data)==null?void 0:p.length});const t=["referral_date","referral_status_id","state_id"];for(const R of t)if(!this.form[R])return console.log(`Field ${R} is missing:`,this.form[R]),!1;if(!((v=this.form.patient)!=null&&v.injury_date))return console.log("Patient injury_date is missing"),!1;if(!((A=this.form.patient)!=null&&A.referral_reason_ids)||this.form.patient.referral_reason_ids.length===0)return console.log("Patient referral_reason_ids is missing or empty:",(F=this.form.patient)==null?void 0:F.referral_reason_ids),!1;if(this.form.state_id){if(((U=(C=this.localDoctors)==null?void 0:C.data)==null?void 0:U.length)===0)return console.log("No doctors available for selected state"),!1;if(((V=(j=this.localPatients)==null?void 0:j.data)==null?void 0:V.length)===0)return console.log("No patients available for selected state"),!1}return this.isDoctor&&!this.form.attorney_user_id&&!this.form.attorney.name?(console.log("Doctor role: attorney information is missing"),!1):this.isAttorney&&!this.form.doctor_user_id&&!this.form.doctor.name?(console.log("Attorney role: doctor information is missing"),!1):!this.form.patient_user_id&&!this.form.patient.name?(console.log("Patient information is missing"),!1):(console.log("Form is ready!"),!0)},getCptLabel(t){const s=(Array.isArray(this.CptCodes)?this.CptCodes:[]).find(f=>f.id===t);return s?`${s.code} - ${s.description}`:"Unknown"},removeCptCode(t){this.form.selectedCptCodes=this.form.selectedCptCodes.filter(r=>r!==t),this.onFormFieldChange()},triggerAutoSelection(){var t,r,s,f,e,o,u,w,m,p,v,A,F,C,U,j,V,R,S,q,d,x,O,z,N,L,B,E,W,Y;if(this.isAttorney){const c=(((t=this.attorneys)==null?void 0:t.data)||[]).find(I=>I.user_id===this.currentUser.user_id);c?(this.form.attorney_user_id=c.user_id,this.form.attorney={name:c.name,email:c.email,phone_number:c.phone_number||"",user_id:c.user_id,law_firm:{name:((r=c.law_firm)==null?void 0:r.name)||"",email:((s=c.law_firm)==null?void 0:s.email)||"",phone_number:((f=c.law_firm)==null?void 0:f.phone_number)||"",address_line_1:((e=c.law_firm)==null?void 0:e.address_line_1)||"",address_line_2:((o=c.law_firm)==null?void 0:o.address_line_2)||"",city:((u=c.law_firm)==null?void 0:u.city)||"",state_id:((w=c.law_firm)==null?void 0:w.state_id)||this.currentUser.state_id||"",zip_code:((m=c.law_firm)==null?void 0:m.zip_code)||""}},this.onFormFieldChange()):this.$toast().warning("Attorney data not found. Please contact administrator.")}else if(this.isDoctor){const c=(((p=this.doctors)==null?void 0:p.data)||[]).find(I=>I.user_id===this.currentUser.user_id);c?(this.form.doctor_user_id=c.user_id,this.form.clinic_id=((A=(v=c.clinics)==null?void 0:v[0])==null?void 0:A.clinic_id)||"",this.form.doctor={user_id:c.user_id,name:c.name,email:c.email,phone_number:c.phone_number||"",medical_specialty_id:c.medical_specialty_id||1,clinic:{clinic_id:((C=(F=c.clinics)==null?void 0:F[0])==null?void 0:C.clinic_id)||"",name:((j=(U=c.clinics)==null?void 0:U[0])==null?void 0:j.name)||"",email:((R=(V=c.clinics)==null?void 0:V[0])==null?void 0:R.email)||"",phone_number:((q=(S=c.clinics)==null?void 0:S[0])==null?void 0:q.phone_number)||"",address_line_1:((x=(d=c.clinics)==null?void 0:d[0])==null?void 0:x.address_line_1)||"",address_line_2:((z=(O=c.clinics)==null?void 0:O[0])==null?void 0:z.address_line_2)||"",city:((L=(N=c.clinics)==null?void 0:N[0])==null?void 0:L.city)||"",state_id:((E=(B=c.clinics)==null?void 0:B[0])==null?void 0:E.state_id)||this.currentUser.state_id||"",zip_code:((Y=(W=c.clinics)==null?void 0:W[0])==null?void 0:Y.zip_code)||""},notes:""},this.onFormFieldChange()):this.$toast().warning("Doctor data not found. Please contact administrator.")}},clearSuccessMessage(){this.showSuccessMessage=!1},resetForm(){this.form.reset(),this.form.clearErrors(),this.showSuccessMessage=!1,this.initializeFormState()},onFormFieldChange(){this.showSuccessMessage&&(this.showSuccessMessage=!1)},redirectWithState(t){if(!t)return;const r=new URL(window.location.href);r.searchParams.set("state_id",t),console.log("Redirecting to:",r.toString()),this.$inertia.visit(r.toString(),{method:"get",preserveState:!1,preserveScroll:!1,replace:!0})},initializeFormState(){var t,r;this.selectedStateId&&!this.form.state_id?this.form.state_id=this.selectedStateId:(t=this.currentUser)!=null&&t.state_id&&!this.form.state_id&&(this.form.state_id=this.currentUser.state_id),this.isAttorney&&((r=this.currentUser)!=null&&r.state_id)&&(this.form.state_id=this.currentUser.state_id)},getCptCodeOptions(){return(Array.isArray(this.CptCodes)?this.CptCodes:[]).map(r=>({label:`${r.code} - ${r.description}`,value:r.id}))}},mounted(){this.localAttorneys=this.attorneys||{data:[]},this.localDoctors=this.doctors||{data:[]},this.localPatients=this.patients||{data:[]},this.$nextTick(()=>{this.triggerAutoSelection(),this.initializeFormState()})}},P=t=>(ie("data-v-7e67d462"),t=t(),ae(),t),qe={key:0,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md"},Pe={class:"flex"},Oe=P(()=>l("div",{class:"flex-shrink-0"},[l("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),Ie={class:"ml-3"},Me=P(()=>l("h3",{class:"text-sm font-medium text-red-800"},"Please fix the following errors:",-1)),ze={class:"mt-2 text-sm text-red-700"},Ne={class:"list-disc pl-5 space-y-1"},Le={key:1,class:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md"},Be=P(()=>l("div",{class:"flex"},[l("div",{class:"flex-shrink-0"},[l("svg",{class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},[l("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM5.293 9.293a1 1 0 011.414 0L9 11.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])]),l("div",{class:"ml-3"},[l("h3",{class:"text-sm font-medium text-green-800"},"Referral created successfully!"),l("div",{class:"mt-2 text-sm text-green-700"}," Your referral has been submitted and is now being processed. ")])],-1)),Ee=[Be],We={class:"h-full divide-y divide-gray-200 space-y-12"},Ye=P(()=>l("span",{class:"text-blue-500 italic"},"Referral State",-1)),He={class:"flex items-center gap-2"},Je={key:0,class:"flex items-center gap-2 text-sm text-gray-500"},Ge=P(()=>l("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"},null,-1)),Ke={key:1,class:"text-sm text-gray-500 italic"},Qe={key:0,class:"mt-2 text-sm text-blue-600 bg-blue-50 p-2 rounded"},Te=P(()=>l("strong",null,"Note:",-1)),Xe={key:2,class:"text-sm text-gray-600 mt-1"},Ze={key:0,class:"selected-codes"},$e=["onClick"],et={class:"col-span-full bg-white rounded-lg shadow-sm border border-gray-200 p-6"},tt=P(()=>l("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Referral Reasons",-1)),rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},st=["id","value"],ot=["for"],it=["value"];function at(t,r,s,f,e,o){const u=b("v-form-label"),w=b("v-form-input"),m=b("v-form-error"),p=b("v-form-group"),v=b("v-form-select"),A=b("v-content-body"),F=b("x-policy-form"),C=b("x-referral-doctor-form"),U=b("x-referral-patient-form"),j=b("x-referral-attorney-form"),V=b("x-referral-documents-form"),R=b("v-button"),S=b("v-form");return n(),D(S,{class:"h-full",onSubmit:X(o.submitForm,["prevent"])},{default:a(()=>{var q;return[Object.keys(e.form.errors).length>0?(n(),k("div",qe,[l("div",Pe,[Oe,l("div",Ie,[Me,l("div",ze,[l("ul",Ne,[(n(!0),k(M,null,H(e.form.errors,(d,x)=>(n(),k("li",{key:x},y(d),1))),128))])])])])])):g("",!0),e.showSuccessMessage?(n(),k("div",Le,Ee)):g("",!0),l("div",We,[l("div",null,[i(A,{class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"},{default:a(()=>[i(p,null,{default:a(()=>[i(u,null,{default:a(()=>[_("Referral Date")]),_:1}),i(w,{type:"date",modelValue:e.form.referral_date,"onUpdate:modelValue":r[0]||(r[0]=d=>e.form.referral_date=d),error:e.form.errors.referral_date,disabled:e.form.processing,onChange:o.onFormFieldChange},null,8,["modelValue","error","disabled","onChange"]),e.form.errors.referral_date?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors.referral_date),1)]),_:1})):g("",!0)]),_:1}),i(p,null,{default:a(()=>{var d;return[i(u,null,{default:a(()=>[_("Referral Status")]),_:1}),i(v,{options:(((d=s.referralStatuses)==null?void 0:d.data)||[]).map(x=>({label:x.name,value:x.referral_status_id})),error:e.form.errors.referral_status_id,disabled:e.form.processing,required:!0,modelValue:e.form.referral_status_id,"onUpdate:modelValue":r[1]||(r[1]=x=>e.form.referral_status_id=x),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.referral_status_id?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors.referral_status_id),1)]),_:1})):g("",!0)]}),_:1}),i(p,null,{default:a(()=>[i(u,null,{default:a(()=>[_("Injury Date")]),_:1}),i(w,{type:"date",modelValue:e.form.patient.injury_date,"onUpdate:modelValue":r[2]||(r[2]=d=>e.form.patient.injury_date=d),error:e.form.errors["patient.injury_date"],disabled:e.form.processing,required:!0,onChange:o.onFormFieldChange},null,8,["modelValue","error","disabled","onChange"]),e.form.errors["patient.injury_date"]?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors["patient.injury_date"]),1)]),_:1})):g("",!0)]),_:1}),i(p,{class:"col-span-full md:col-span-2"},{default:a(()=>[i(u,null,{default:a(()=>[Ye]),_:1}),l("div",He,[i(v,{options:o.availableStates,error:e.form.errors.state_id,disabled:e.form.processing||o.isAttorney,required:!0,modelValue:e.form.state_id,"onUpdate:modelValue":r[3]||(r[3]=d=>e.form.state_id=d),onChange:o.onFormFieldChange,class:"flex-1"},null,8,["options","error","disabled","modelValue","onChange"]),e.isUpdatingData?(n(),k("div",Je,[Ge,_(" Updating... ")])):g("",!0),o.isAttorney?(n(),k("div",Ke," (Attorney's state) ")):g("",!0)]),o.isAttorney?(n(),k("div",Qe,[Te,_(" As an attorney, you can only create referrals within your assigned state. Only doctors and patients from your state will be available for selection. ")])):g("",!0),e.form.errors.state_id?(n(),D(m,{key:1},{default:a(()=>[_(y(e.form.errors.state_id),1)]),_:1})):g("",!0),e.form.state_id?(n(),k("div",Xe," Selected: "+y(o.currentStateName),1)):g("",!0)]),_:1}),i(p,null,{default:a(()=>[i(u,null,{default:a(()=>[_("CPT Codes")]),_:1}),i(v,{options:o.getCptCodeOptions(),error:e.form.errors.cpt_code_id,disabled:e.form.processing,required:!0,multiple:"",modelValue:e.form.selectedCptCodes,"onUpdate:modelValue":r[4]||(r[4]=d=>e.form.selectedCptCodes=d),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.selectedCptCodes.length?(n(),k("div",Ze,[(n(!0),k(M,null,H(e.form.selectedCptCodes,(d,x)=>(n(),k("span",{key:x,class:"badge"},[_(y(o.getCptLabel(d))+" ",1),l("button",{type:"button",onClick:O=>o.removeCptCode(d),class:"remove-btn"},"Ã—",8,$e)]))),128))])):g("",!0),e.form.errors.cpt_code_id?(n(),D(m,{key:1},{default:a(()=>[_(y(e.form.errors.cpt_code_id),1)]),_:1})):g("",!0)]),_:1}),i(p,null,{default:a(()=>{var d;return[i(u,null,{default:a(()=>[_("Piloting Physician")]),_:1}),i(v,{options:(((d=s.physicians)==null?void 0:d.data)||[]).map(x=>({label:x.name,value:x.user_id})),error:e.form.errors.doctor_user_id,disabled:e.form.processing,required:!0,modelValue:e.form.doctor_user_id,"onUpdate:modelValue":r[5]||(r[5]=x=>e.form.doctor_user_id=x),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.doctor_user_id?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors.doctor_user_id),1)]),_:1})):g("",!0)]}),_:1}),i(p,null,{default:a(()=>[i(u,null,{default:a(()=>[_("Billing Type")]),_:1}),i(v,{options:["LOP","Insurance"].map(d=>({label:d,value:d})),error:e.form.errors.billing_type,disabled:e.form.processing,required:!0,modelValue:e.form.billing_type,"onUpdate:modelValue":r[6]||(r[6]=d=>e.form.billing_type=d),onChange:o.onFormFieldChange},null,8,["options","error","disabled","modelValue","onChange"]),e.form.errors.billing_type?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors.billing_type),1)]),_:1})):g("",!0)]),_:1})]),_:1})]),i(F,{"onUpdate:insuranceData":o.handleInsuranceData},null,8,["onUpdate:insuranceData"]),i(C,{attorneys:o.doctorsData,doctors:o.doctorsData,"document-categories":s.documentCategories,form:e.form,"medical-specialties":s.medicalSpecialties,patients:o.patientsData,"referral-reasons":s.referralReasons,"referral-statuses":s.referralStatuses,states:s.states},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states"]),i(U,{attorneys:o.attorneysData,doctors:o.doctorsData,"document-categories":s.documentCategories,form:e.form,"medical-specialties":s.medicalSpecialties,patients:o.patientsData,"referral-reasons":s.referralReasons,"referral-statuses":s.referralStatuses,states:s.states,icdCodes:s.icdCodes},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states","icdCodes"]),l("div",et,[tt,l("div",rt,[(n(!0),k(M,null,H(((q=s.referralReasons)==null?void 0:q.data)||[],d=>(n(),k("div",{key:d.referral_reason_id,class:"flex items-center"},[re(l("input",{type:"checkbox",id:"reason_"+d.referral_reason_id,value:d.referral_reason_id,"onUpdate:modelValue":r[7]||(r[7]=x=>e.form.patient.referral_reason_ids=x),onChange:r[8]||(r[8]=(...x)=>o.onFormFieldChange&&o.onFormFieldChange(...x)),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,40,st),[[se,e.form.patient.referral_reason_ids]]),l("label",{for:"reason_"+d.referral_reason_id,class:"ml-2 text-sm text-gray-700"},y(d.name),9,ot)]))),128))]),e.form.errors["patient.referral_reason_ids"]?(n(),D(m,{key:0},{default:a(()=>[_(y(e.form.errors["patient.referral_reason_ids"]),1)]),_:1})):g("",!0)]),i(j,{attorneys:o.attorneysData,form:e.form,"user-role":o.userRole,patients:o.patientsData,"referral-reasons":s.referralReasons,states:s.states},null,8,["attorneys","form","user-role","patients","referral-reasons","states"]),i(V,{attorneys:s.attorneys,doctors:s.doctors,"document-categories":s.documentCategories,form:e.form,"medical-specialties":s.medicalSpecialties,patients:s.patients,"referral-reasons":s.referralReasons,"referral-statuses":s.referralStatuses,states:s.states},null,8,["attorneys","doctors","document-categories","form","medical-specialties","patients","referral-reasons","referral-statuses","states"]),i(p,{class:"col-span-full flex items-center justify-end gap-2 text-right border-t border-gray-200 bg-gray-50 px-6 py-4"},{default:a(()=>[e.form.progress?(n(),k("progress",{key:0,value:e.form.progress.percentage,max:"100"},y(e.form.progress.percentage)+"% ",9,it)):g("",!0),i(R,{href:t.route(s.listRoute),color:"white",disabled:e.form.processing},{default:a(()=>[_(" Cancel ")]),_:1},8,["href","disabled"]),i(R,{onClick:o.resetForm,color:"gray",disabled:e.form.processing},{default:a(()=>[_(" Reset ")]),_:1},8,["onClick","disabled"]),i(R,{disabled:e.form.processing||!o.isFormReady(),class:oe({"opacity-50":!o.isFormReady()})},{default:a(()=>[_(y(o.isFormReady()?"Create Referral":"Please fill required fields"),1)]),_:1},8,["disabled","class"])]),_:1})])]}),_:1},8,["onSubmit"])}const ct=G(je,[["render",at],["__scopeId","data-v-7e67d462"]]);export{ct as R};
